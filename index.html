
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyBanana AI | Peel the Noise</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg-dark: #0a0a0a; --gold: #f1c40f; --safe: #2ecc71; --warn: #e67e22; --danger: #8e44ad; }
        body { margin: 0; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: var(--bg-dark); color: #fff; font-family: 'Inter', sans-serif; padding: 40px 0; }
        
        #airdrop-zone { position: fixed; top: 20px; left: 20px; z-index: 100; }
        .airdrop-badge { background: rgba(241, 196, 15, 0.1); border: 1px solid var(--gold); padding: 10px 18px; border-radius: 30px; font-size: 0.75rem; color: var(--gold); cursor: pointer; animation: pulse 2s infinite; }
        #whitelist-input { display: none; margin-top: 10px; background: #141414; border: 1px solid var(--gold); padding: 15px; border-radius: 15px; width: 250px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        
        .banana-core { width: 180px; height: 180px; background: linear-gradient(45deg, #f39c12, #f1c40f); border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; box-shadow: 0 0 60px rgba(241,196,15,0.2); animation: morph 8s infinite; margin-bottom: 30px; }
        @keyframes morph { 0%, 100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; } 50% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(241,196,15,0.4); } 70% { box-shadow: 0 0 0 10px rgba(241,196,15,0); } 100% { box-shadow: 0 0 0 0 rgba(241,196,15,0); } }

        #status-container { text-align: center; width: 100%; max-width: 400px; padding: 0 20px; }
        .config-panel { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); padding: 20px; border-radius: 20px; margin-bottom: 25px; text-align: left; }
        .slider-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .slider-value { color: var(--gold); font-weight: bold; font-family: monospace; font-size: 1.2rem; }
        
        input[type=range] { width: 100%; -webkit-appearance: none; background: rgba(255,255,255,0.1); height: 4px; border-radius: 2px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: var(--gold); border-radius: 50%; cursor: pointer; }

        .feed-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; margin-bottom: 8px; background: rgba(255,255,255,0.02); border-radius: 10px; transition: 0.3s; }
        .feed-item:hover { background: rgba(255,255,255,0.05); transform: translateX(5px); }
        .score-tag { padding: 3px 8px; border-radius: 5px; font-weight: bold; font-size: 0.7rem; border: 1px solid rgba(255,255,255,0.1); }

        #fb-btn { position: fixed; bottom: 20px; right: 20px; background: var(--gold); color: #000; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1000; }
        #fb-modal { display: none; position: fixed; bottom: 75px; right: 20px; background: #1a1a1a; border: 1px solid var(--gold); padding: 15px; border-radius: 12px; width: 260px; z-index: 1000; }
    </style>
</head>
<body>

    <div id="airdrop-zone">
        <div class="airdrop-badge" id="airdrop-btn" onclick="toggleWhitelist()"><i class="fa-solid fa-parachute-box"></i> EARLY ACCESS</div>
        <div id="whitelist-input">
            <input type="text" id="user-wallet" placeholder="Solana Address" style="background:transparent; border:none; border-bottom:1px solid #333; color:#fff; padding:8px; width:100%; box-sizing:border-box; outline:none; font-size:0.8rem; margin-bottom:12px;">
            <button onclick="submitWhitelist()" style="background:var(--gold); border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:bold; width:100%;">SYNC SETTINGS</button>
        </div>
    </div>

    <div class="banana-core" id="ball"></div>

    <div id="status-container">
        <div id="status-text" style="margin-bottom:20px; min-height:3rem;">Peeling Solana Alphas...</div>
        
        <div class="config-panel">
            <div class="slider-header">
                <span style="font-size:0.7rem; color:#666; letter-spacing:1px;">ALERT THRESHOLD</span>
                <span class="slider-value" id="score-val">300</span>
            </div>
            <input type="range" id="score-range" min="0" max="1000" value="300" oninput="document.getElementById('score-val').innerText=this.value" onchange="saveStrategy(this.value)">
            <p style="font-size: 0.6rem; color: #444; margin-top: 10px;">Pro Mode: $5K+ Liquidity & 80%+ LP Locked required.</p>
        </div>

        <div id="history-feed"></div>
    </div>

    <div id="fb-btn" onclick="document.getElementById('fb-modal').style.display='block'"><i class="fa-solid fa-lightbulb"></i></div>
    <div id="fb-modal">
        <textarea id="fb-text" placeholder="Idea or Bug?" style="width:100%; height:60px; background:#000; color:#fff; border:1px solid #333; border-radius:5px; padding:5px; font-size:0.7rem; outline:none;"></textarea>
        <button onclick="submitFeedback()" style="width:100%; margin-top:8px; background:var(--gold); border:none; padding:5px; border-radius:5px; font-weight:bold; cursor:pointer;">SEND IDEA</button>
        <button onclick="document.getElementById('fb-modal').style.display='none'" style="width:100%; margin-top:5px; background:transparent; color:#666; border:none; font-size:0.6rem; cursor:pointer;">CLOSE</button>
    </div>

    <script>
        const SB_URL = "https://ctizvqaqnsavuawprgzu.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0aXp2cWFxbnNhdnVhd3ByZ3p1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1NzQwMzYsImV4cCI6MjA4MjE1MDAzNn0.-op8Pbjwv8YAPAFg7mnIk1tHgA1vi4Vf7i4yufvLaAA";
        let lastSig = "";
        let currentUserWallet = localStorage.getItem('mybanana_wallet') || "";

        if (currentUserWallet) { document.getElementById('user-wallet').value = currentUserWallet; loadUser(currentUserWallet); }

        async function updateSignal() {
            const res = await fetch(`${SB_URL}/rest/v1/signals?select=*&order=created_at.desc&limit=5`, { headers: { "apikey": SB_KEY, "Authorization": `Bearer ${SB_KEY}` } });
            const data = await res.json();
            if (data && data.length > 0 && data[0].sig !== lastSig) {
                lastSig = data[0].sig;
                document.getElementById('status-text').innerText = data[0].taste;
                renderFeed(data);
            }
        }

        function renderFeed(list) {
            const feed = document.getElementById('history-feed');
            feed.innerHTML = '<div style="font-size:0.6rem; color:#333; text-align:left; margin-bottom:10px;">PRO RADAR FEED</div>';
            list.forEach(i => {
                const color = i.score < 100 ? '#f1c40f' : '#e67e22';
                feed.innerHTML += `<div class="feed-item">
                    <div style="text-align:left"><div style="color:#eee; font-family:monospace; font-size:0.8rem;">${i.address.slice(0,6)}...${i.address.slice(-4)}</div></div>
                    <span class="score-tag" style="color:${color}; border-color:${color}">${i.score}</span>
                </div>`;
            });
        }

        async function saveStrategy(val) {
            if (!currentUserWallet) return alert("Sync wallet first!");
            await fetch(`${SB_URL}/rest/v1/whitelist?address=eq.${currentUserWallet}`, { method: 'PATCH', headers: { "apikey": SB_KEY, "Authorization": `Bearer ${SB_KEY}`, "Content-Type": "application/json" }, body: JSON.stringify({ min_score: parseInt(val) }) });
        }

        async function submitWhitelist() {
            const addr = document.getElementById('user-wallet').value.trim();
            const res = await fetch(`${SB_URL}/rest/v1/whitelist`, { method: 'POST', headers: { "apikey": SB_KEY, "Authorization": `Bearer ${SB_KEY}`, "Content-Type": "application/json" }, body: JSON.stringify({ address: addr, min_score: 300 }) });
            if (res.ok || res.status === 409) {
                currentUserWallet = addr; localStorage.setItem('mybanana_wallet', addr);
                toggleWhitelist(); alert("Linked! Start adjusting your threshold.");
            }
        }

        async function submitFeedback() {
            const text = document.getElementById('fb-text').value;
            await fetch(`${SB_URL}/rest/v1/feedbacks`, { method: 'POST', headers: { "apikey": SB_KEY, "Authorization": `Bearer ${SB_KEY}`, "Content-Type": "application/json" }, body: JSON.stringify({ user_id: currentUserWallet, content: text, source: 'web' }) });
            alert("Sent!"); document.getElementById('fb-modal').style.display='none';
        }

        async function loadUser(w) {
            const res = await fetch(`${SB_URL}/rest/v1/whitelist?address=eq.${w}`, { headers: { "apikey": SB_KEY, "Authorization": `Bearer ${SB_KEY}` } });
            const data = await res.json();
            if (data.length > 0) { document.getElementById('score-range').value = data[0].min_score; document.getElementById('score-val').innerText = data[0].min_score; }
        }

        function toggleWhitelist() { const el = document.getElementById('whitelist-input'); el.style.display = el.style.display === 'none' ? 'block' : 'none'; }
        setInterval(updateSignal, 3000); updateSignal();
    </script>
</body>
</html>
